# CSV Split Mule Extension module

CSVファイルを分割、連結するモジュールです。

## 説明

### 共通設定
OSに付属のsplitコマンドを使用する場合は、パスを指定します。(Javaの実装よりも高速です)
作業用ディレクトリは、[Work dir]へ指定します。デフォルトでは/tmp/mule-workとなっています。

| パラメータ  | 説明                                                  | デフォルト   |
|:----------|:-----------------------------------------------------|:-----------|
| External split command     | OS上のsplitコマンドのパス。指定なしの場合はJavaによる実装を使用する     | -  |
| Work dir  | 指定したディレクトリの下にテンポラリファイルの子ディレクトリを作成し分割ファイルを出力する   | /tmp/mule-work |

---

### ファイル分割 (Split)
Splitプロセッサで分割を行います。共通設定で、OS付属のsplitコマンドを使用するように設定することも可能です。
Java実装を使用した場合は、デフォルトで、/tmp/mule-workの下にディレクトリを作成し、S_XXXXXという分割ファイルを作成し
それらの絶対パスを配列として次のプロセッサへ渡します。
splitコマンドを使用した場合は、同ディレクトりに、xaa, xab ...といったファイルが作成されます。
Correlation Idは分割後のファイルを配置する領域のIDとなります。デフォルトは自動でIDを振りますが、一時領域を削除する際のキーとして指定してください

| パラメータ  | 説明                                                  | デフォルト   |
|:----------|:-----------------------------------------------------|:-----------|
| Src file path  | 分割するファイルパス                                      | payload  |
| Line  | 1ファイルに格納する行数                                       | 10000   |
| Chunk size  | 分割処理の単位。デフォルトでは1000行ごとにファイルへ書き込む   | 1000   |
| Correlation Id  | 作業ディレクトリの下に作成する一時領域用のID   | 自動   |

---

### ファイル連結 (Concat)
Concatプロセッサでファイルの連結を行います。
分割されたファイルパスを配列でFilesパラメータにてうけとり連結処理を行います。
デフォルトでは、Filesパラメータにはpayloadが指定されています。
出力パスを [Target File Path]へ記述します。

| パラメータ  | 説明                                                  | デフォルト   |
|:----------|:-----------------------------------------------------|:-----------|
| Files     | 連結するファイルパス                                      | payload  |
| Target file path  | 出力先ファイルパス                                | /tmp/result.csv   |
| Delete temporary files  | 分割したファイル（受け取ったファイルリスト上のファイル）を削除するかどうか指定する   | true   |

---

### 一時領域削除 (Clean Work Directory)
作業ディレクトリ内に作成された一時領域を削除します。Splitプロセッサに渡したCorrelation Idを指定することで
その領域のみ削除できます。

| パラメータ  | 説明                                                  | デフォルト   |
|:----------|:-----------------------------------------------------|:-----------|
| Correlation Id  | 作業ディレクトリの下に作成する一時領域用のID   | 自動   |
| Delete Work Directory | 作業ディレクトリを削除する   | true   |
---


## インストール

リポジトリをcloneして、以下のコマンドを実行します。(テストについては実装中)
```
$ mvn package 
```
targetディレクトリへ出力されたjarファイルをAnypoint StudioのPackage Exploreで右クリックを行い
[Manage Dependencies] - [Manage Modules]で、jarのインストールを行います。


